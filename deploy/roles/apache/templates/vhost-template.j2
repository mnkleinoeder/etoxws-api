# {{ansible_managed}}

{% if APACHE_USE_HTTP | bool %}
<VirtualHost *:80>
	ServerAdmin {{APACHE_SERVER_ADMIN}}
	ServerName  {{VHOST_SERVER_NAME}}

  {% if VHOST_SERVER_ALIAS | default('') %}
    ServerAlias {{ VHOST_SERVER_ALIAS }}
  {% endif %}

	DocumentRoot {{VHOST_DOC_ROOT}}
	LogLevel {{APACHE_LOG_LEVEL}}
	CustomLog {{SYS_APACHE_LOG_DIR}}/{{VHOST_SERVER_NAME}}.com_access.log combined
	ErrorLog  {{SYS_APACHE_LOG_DIR}}/{{VHOST_SERVER_NAME}}.com_error.log
  {{SYS_APACHE_INCLUDE_CONF}} {{VHOST_CONF_DIR}}/*.conf-nossl
  {{SYS_APACHE_INCLUDE_CONF}} {{VHOST_CONF_DIR}}/*.conf

</VirtualHost>

{% endif %}

{% if APACHE_USE_HTTPS | bool %}
<IfModule mod_ssl.c>
<VirtualHost *:443>
	ServerAdmin {{APACHE_SERVER_ADMIN}}
	ServerName  {{VHOST_SERVER_NAME}}

  {% if VHOST_SERVER_ALIAS | default('') %}
    ServerAlias {{ VHOST_SERVER_ALIAS }}
  {% endif %}

	DocumentRoot {{VHOST_DOC_ROOT}}

    LogLevel {{APACHE_LOG_LEVEL}}
    CustomLog {{SYS_APACHE_LOG_DIR}}/{{VHOST_SERVER_NAME}}-ssl_access.log combined
    ErrorLog  {{SYS_APACHE_LOG_DIR}}/{{VHOST_SERVER_NAME}}-ssl_error.log
{% if SYS_APACHE_VERSION != '2.4' %}
	<IfModule mod_rewrite.c>
		RewriteLog {{SYS_APACHE_LOG_DIR}}/{{VHOST_SERVER_NAME}}-ssl_rewrite.log
		RewriteLogLevel 9
	</IfModule>
{% endif %}

	SSLEngine on
	SSLProtocol All -SSLv2 -SSLv3
	SSLCertificateFile    {{VHOST_SSL_DIR}}/{{VHOST_SSL_CERTFILE}}
	SSLCertificateKeyFile {{VHOST_SSL_DIR}}/{{VHOST_SSL_KEYFILE}}
	{% if VHOST_SSL_CACERTFILE %}
	SSLCACertificateFile  {{VHOST_SSL_DIR}}/{{VHOST_SSL_CACERTFILE}}
	{% endif %}
	<FilesMatch "\.(cgi|shtml|phtml|php)$">
		SSLOptions +StdEnvVars
	</FilesMatch>
	<Directory /usr/lib/cgi-bin>
		SSLOptions +StdEnvVars
	</Directory>
	BrowserMatch "MSIE [2-6]" \
		nokeepalive ssl-unclean-shutdown \
		downgrade-1.0 force-response-1.0
	BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown
  {{SYS_APACHE_INCLUDE_CONF}} {{VHOST_CONF_DIR}}/*.conf-ssl
  {{SYS_APACHE_INCLUDE_CONF}} {{VHOST_CONF_DIR}}/*.conf
</VirtualHost>
</IfModule>
{% endif %}
